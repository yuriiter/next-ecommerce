import Head from "next/head";
import { Banner } from "@/components/Banner";
import bannerCar1 from "@/assets/img/banner_car_1.png";
import bannerCar2 from "@/assets/img/banner_car_2.png";
import { useEffect, useMemo, useState } from "react";
import { CardsContainer } from "@/components/Cards";
import { ShowMore } from "@/components/Cards/ShowMore";
import { popularCarsMockup, recommendationCars } from "@/constants/mockupData";
import { PickerSection } from "@/components/Picker/PickerSection";
import { usePickerSectionData } from "@/components/Picker/hooks/usePickerSectionData";
import axios from "axios";
import { useToast } from "@/components/Toast/useToast";

const promised = (duration: number) =>
  new Promise((resolve) => {
    setTimeout(() => resolve(1), duration);
  });

export default function Home() {
  const toast = useToast();

  const testToast = () => {
    // toast.promisify(promised(4000), {'pending': "Loading response...", success: "Response loaded!"})
    toast.addToast({ content: "Test", type: "success", duration: 4000 });
  };

  const [recommendationCarsDisplayLimit, setRecommendationCarsDisplayLimit] =
    useState(8);

  const recommendationCarsToDisplay = useMemo(() => {
    return recommendationCars.slice(0, recommendationCarsDisplayLimit);
  }, [recommendationCarsDisplayLimit]);

  const { pickUpData, setPickUpData, dropOffData, setDropOffData } =
    usePickerSectionData();

  // useEffect(() => {
  //   fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/cars`)
  //     // fetch("https://google.com")
  //     .then((response) => {
  //       if (response.ok) return response.text();
  //       else throw "Not found";
  //     })
  //     .then((text) => console.log(text))
  //     .catch((err) => console.error(err));
  // }, []);

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <section onClick={testToast} className="container banner__section">
        <Banner
          variant="light"
          title="The Best Platform for Car Rental"
          description="Ease of doing a car rental safely and reliably. Of course at a low price."
          buttonText="Rental car"
          href="/rental"
          carPicture={bannerCar1}
        />
        <Banner
          variant="dark"
          title="Easy way to rent a car at a low price"
          description="Providing cheap car rental services and safe and comfortable facilities."
          buttonText="Rental car"
          href="/rental"
          carPicture={bannerCar2}
        />
      </section>
      <PickerSection
        className="container"
        pickUpData={pickUpData}
        setPickUpData={setPickUpData}
        dropOffData={dropOffData}
        setDropOffData={setDropOffData}
      />
      <section className="container cards__section">
        <CardsContainer
          cards={popularCarsMockup}
          title="Popular cars"
          rightLink={{ href: "/popular", content: "view all" }}
          horizontalScrolling
        />
      </section>
      <section className="container cards__section cards__section--recommended">
        <CardsContainer
          cards={recommendationCarsToDisplay}
          title="Recomendation cars"
        />
        <ShowMore
          step={8}
          totalItemsCount={recommendationCars.length}
          itemsToShowLimit={recommendationCarsDisplayLimit}
          setItemsToShowLimit={setRecommendationCarsDisplayLimit}
          itemNamePlural="cars"
          itemNameSingular="car"
        />
      </section>
    </>
  );
}
